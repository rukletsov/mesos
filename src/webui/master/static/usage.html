<html>
<head>
<!-- Load c3.css -->
<link href="/static/c3/c3.css" rel="stylesheet" type="text/css">
<script src="/static/d3/d3.min.js" charset="utf-8"></script>
<script src="/static/c3/c3.min.js"></script>
<link href="/static/css/bootstrap-3.0.3.min.css" rel="stylesheet">
</head>
<body>
<h1>Mesos Resource Accounting</h1>
<div id="chart"></div>
<table class="table table-striped">
<thead>
<th>
Framework id
</th>
<th>
CPU/hr
</th>
<th>
Mem/hr
</th>
</thead>
<tbody>
</tbody>
</table>
<script>
var loc = "/master/usage.json"

var chart = 0

function load() {
  d3.json(loc, function(data) {
    var frameworkTypes = []
    var group = []
    var columns = []

    var runningSum = {}

    for (index = 0; index < data["usage"].length; ++index) {
      var sample = data["usage"][index]["frameworks"]

      for (sampleIndex = 0; sampleIndex < sample.length; ++sampleIndex) {
        framework_id = sample[sampleIndex]["framework_id"]
        frameworkTypes[framework_id] = 'area'
        group.push(framework_id)

        if (runningSum[framework_id] == undefined) {
          runningSum[framework_id] = []
        }

        runningSum[framework_id].push(sample[sampleIndex].cpus)
      }
    }

    for (index = 0; index < group.length; ++index) {
      framework_id = group[index]
      row = [framework_id]

      for (sumIndex = 0; sumIndex < runningSum[framework_id].length; ++sumIndex) {
        row.push(runningSum[framework_id][sumIndex])
      }

      columns.push(row)
    }

    console.log(row)


    chart = c3.generate({
      bindto: '#chart',
      data: {
        columns:
        //[
          // ['framework1', 30, 200, 100, 400, 150, 250],
          // ['framework2', 50, 20, 10, 40, 15, 25]
        //],
        columns,
        types: frameworkTypes,
        groups: [group]
      }
    });

  });
}

var stop = setInterval(load, 2000)

</script>
</body>
</html>
